<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}PXMX - Proxmox Administration Dashboard{% endblock %}</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.css">
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/modern-theme.css' %}">

    {% block extra_css %}{% endblock %}

    <!-- Real-time Sync JavaScript -->
    <script src="{% static 'js/realtime-sync.js' %}" defer></script>
</head>
<body>
    <!-- Left Sidebar -->
    <nav class="sidebar">
        <a href="{% url 'dashboard' %}" class="sidebar-icon {% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}">
            <i class="bi bi-grid-fill"></i>
        </a>
        <a href="{% url 'cluster_list' %}" class="sidebar-icon {% if 'cluster' in request.resolver_match.url_name %}active{% endif %}">
            <i class="bi bi-hdd-rack-fill"></i>
        </a>
        <a href="{% url 'vm_list' %}" class="sidebar-icon {% if 'vm' in request.resolver_match.url_name %}active{% endif %}">
            <i class="bi bi-boxes"></i>
        </a>
        <a href="{% url 'audit_log' %}" class="sidebar-icon {% if request.resolver_match.url_name == 'audit_log' %}active{% endif %}">
            <i class="bi bi-journal-text"></i>
        </a>
        <div style="flex: 1;"></div>
        <a href="#" onclick="event.preventDefault(); realtimeSync.syncAllClusters(this);" class="sidebar-icon" data-sync-button title="Sync All Clusters">
            <i class="bi bi-arrow-repeat"></i>
        </a>
        <a href="{% url 'admin:index' %}" class="sidebar-icon">
            <i class="bi bi-gear-fill"></i>
        </a>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <div class="top-nav">
            <div>
                <div class="breadcrumb">Home / {% block breadcrumb %}Dashboard{% endblock %}</div>
                <h1 class="page-title">{% block page_title %}Dashboard{% endblock %}</h1>
            </div>
            <div class="nav-actions">
                <span class="nav-link"><i class="bi bi-person-circle"></i> {{ user.username }}</span>
                <a href="{% url 'admin:logout' %}" class="nav-link">
                    <i class="bi bi-box-arrow-right"></i> Logout
                </a>
            </div>
        </div>

        <!-- Messages -->
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }}" style="margin-bottom: 1.5rem; padding: 1rem; border-radius: 8px; background: rgba(59, 130, 246, 0.2); color: #3b82f6; border: 1px solid rgba(59, 130, 246, 0.3);">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}

        <!-- Content Block -->
        {% block content %}{% endblock %}
    </main>

    <!-- Right Sidebar -->
    <aside class="right-sidebar">
        <div class="user-profile">
            <div class="user-avatar">{{ user.username|first|upper }}</div>
            <div class="user-info">
                <div class="user-name">{{ user.username }}</div>
                <div class="user-subtitle">Administrator</div>
            </div>
        </div>

        <div class="sidebar-section">
            <div class="section-title">Cluster Stats</div>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value">{{ clusters.count }}</div>
                    <div class="stat-label">Clusters</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">{{ nodes.count }}</div>
                    <div class="stat-label">Nodes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">{{ vms.count }}</div>
                    <div class="stat-label">Total VMs</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">{{ running_vms }}</div>
                    <div class="stat-label">Running</div>
                </div>
            </div>
        </div>

        <div class="sidebar-section">
            <div class="section-title">System Health</div>
            <div class="efficiency-grid">
                <div class="efficiency-item">
                    <div class="circle-progress">{{ avg_cpu|floatformat:0 }}%</div>
                    <div class="efficiency-label">CPU</div>
                </div>
                <div class="efficiency-item">
                    <div class="circle-progress">{{ avg_ram|floatformat:0 }}%</div>
                    <div class="efficiency-label">RAM</div>
                </div>
                <div class="efficiency-item">
                    <div class="circle-progress">{{ online_nodes }}</div>
                    <div class="efficiency-label">Online</div>
                </div>
                <div class="efficiency-item">
                    <div class="circle-progress">{{ total_nodes|default:0 }}</div>
                    <div class="efficiency-label">Total</div>
                </div>
            </div>
        </div>

        <div class="sidebar-section">
            <div class="section-title">Quick Actions</div>
            <div class="schedule-list">
                <a href="{% url 'vm_list' %}" class="schedule-item" style="border-left-color: var(--accent-purple); text-decoration: none; color: inherit;">
                    <div>
                        <div class="schedule-time">View All VMs</div>
                        <div class="schedule-desc">Manage virtual machines</div>
                    </div>
                </a>
                <a href="{% url 'sync_all_clusters' %}" class="schedule-item" style="border-left-color: var(--accent-cyan); text-decoration: none; color: inherit;">
                    <div>
                        <div class="schedule-time">Sync Data</div>
                        <div class="schedule-desc">Refresh from Proxmox</div>
                    </div>
                </a>
                <a href="{% url 'admin:proxmox_manager_proxmoxcluster_add' %}" class="schedule-item" style="border-left-color: var(--accent-green); text-decoration: none; color: inherit;">
                    <div>
                        <div class="schedule-time">Add Cluster</div>
                        <div class="schedule-desc">Connect new cluster</div>
                    </div>
                </a>
            </div>
        </div>
    </aside>

    {% block extra_js %}{% endblock %}
</body>
</html>
