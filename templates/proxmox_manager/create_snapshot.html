{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block breadcrumb %}<a href="{% url 'vm_list' %}" style="color: var(--text-secondary); text-decoration: none;">Virtual Machines</a> / <a href="{% url 'vm_detail' vm.id %}" style="color: var(--text-secondary); text-decoration: none;">{{ vm.name }}</a> / Create Snapshot{% endblock %}
{% block page_title %}Create Snapshot{% endblock %}

{% block content %}
<!-- VM Header with Icon -->
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
    <div style="display: flex; align-items: center; gap: 1.5rem;">
        <div style="width: 72px; height: 72px; background: linear-gradient(135deg, var(--accent-cyan), var(--accent-blue)); border-radius: 20px; display: flex; align-items: center; justify-content: center; box-shadow: 0 8px 24px rgba(6, 182, 212, 0.3);">
            <i class="bi bi-camera text-white" style="font-size: 2.25rem;"></i>
        </div>
        <div>
            <h2 style="font-size: 2rem; font-weight: 700; margin: 0 0 0.5rem 0;">Create Snapshot</h2>
            <div style="color: var(--text-secondary); font-size: 1rem; display: flex; align-items: center; gap: 0.75rem;">
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <i class="bi bi-{% if vm.vm_type == 'qemu' %}laptop{% else %}box{% endif %}" style="color: var(--accent-cyan);"></i>
                    <span style="font-weight: 600; color: var(--text-primary);">{{ vm.name }}</span>
                </div>
                <span style="opacity: 0.5;">â€¢</span>
                <span class="badge" style="background: rgba(255, 255, 255, 0.1); padding: 0.375rem 0.75rem;">ID: {{ vm.vmid }}</span>
            </div>
        </div>
    </div>
    <div>
        {% if vm.status == 'running' %}
            <span class="badge badge-success" style="padding: 0.625rem 1.25rem; font-size: 0.875rem;">
                <i class="bi bi-circle-fill" style="font-size: 0.5rem;"></i> Running
            </span>
        {% elif vm.status == 'stopped' %}
            <span class="badge badge-warning" style="padding: 0.625rem 1.25rem; font-size: 0.875rem;">
                <i class="bi bi-circle-fill" style="font-size: 0.5rem;"></i> Stopped
            </span>
        {% else %}
            <span class="badge" style="background: var(--text-secondary); padding: 0.625rem 1.25rem; font-size: 0.875rem;">
                {{ vm.status|title }}
            </span>
        {% endif %}
    </div>
</div>

<div style="display: grid; grid-template-columns: 2fr 1fr; gap: 1.5rem;">
    <!-- Main Form Card -->
    <div>
        <div class="task-card" style="padding: 2rem; background: rgba(42, 47, 84, 0.6); position: relative; overflow: hidden;">
            <!-- Gradient Accent -->
            <div style="position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, var(--accent-cyan), var(--accent-blue), var(--accent-purple));"></div>

            <h3 style="font-size: 1.5rem; font-weight: 700; margin: 0 0 0.5rem 0; display: flex; align-items: center; gap: 0.75rem;">
                <i class="bi bi-camera" style="color: var(--accent-cyan);"></i>
                Snapshot Configuration
            </h3>
            <p style="color: var(--text-secondary); margin: 0 0 2rem 0; font-size: 0.9375rem;">
                Create a point-in-time snapshot of your virtual machine for backup and recovery.
            </p>

            <form method="post">
                {% csrf_token %}

                <!-- Modern Input Field -->
                <div style="margin-bottom: 2rem;">
                    <label for="id_name" style="display: block; font-weight: 600; font-size: 0.9375rem; margin-bottom: 0.75rem; color: var(--text-primary);">
                        <i class="bi bi-tag"></i> Snapshot Name
                    </label>
                    <div style="position: relative;">
                        <input type="text"
                               name="name"
                               id="id_name"
                               placeholder="e.g., before-update-2024"
                               required
                               style="width: 100%;
                                      padding: 1.25rem 1.5rem;
                                      background: rgba(26, 29, 46, 0.8);
                                      border: 2px solid rgba(255, 255, 255, 0.1);
                                      border-radius: 12px;
                                      color: var(--text-primary);
                                      font-size: 1.125rem;
                                      font-weight: 500;
                                      transition: all 0.3s ease;
                                      outline: none;">
                        <div style="position: absolute; right: 1.5rem; top: 50%; transform: translateY(-50%); pointer-events: none;">
                            <i class="bi bi-pencil" style="color: var(--text-secondary); font-size: 1.25rem;"></i>
                        </div>
                    </div>
                    <div style="margin-top: 0.5rem; font-size: 0.8125rem; color: var(--text-secondary);">
                        <i class="bi bi-info-circle"></i> Use a descriptive name to identify this snapshot later
                    </div>
                </div>

                <!-- Description Field (if exists in form) -->
                {% if form.description %}
                <div style="margin-bottom: 2rem;">
                    <label for="id_description" style="display: block; font-weight: 600; font-size: 0.9375rem; margin-bottom: 0.75rem; color: var(--text-primary);">
                        <i class="bi bi-text-left"></i> Description (Optional)
                    </label>
                    <textarea name="description"
                              id="id_description"
                              rows="3"
                              placeholder="Add notes about this snapshot..."
                              style="width: 100%;
                                     padding: 1rem 1.5rem;
                                     background: rgba(26, 29, 46, 0.8);
                                     border: 2px solid rgba(255, 255, 255, 0.1);
                                     border-radius: 12px;
                                     color: var(--text-primary);
                                     font-size: 0.9375rem;
                                     transition: all 0.3s ease;
                                     outline: none;
                                     resize: vertical;
                                     font-family: inherit;"></textarea>
                </div>
                {% endif %}

                <!-- Action Buttons -->
                <div style="display: flex; gap: 1rem; margin-top: 2.5rem;">
                    <a href="{% url 'vm_detail' vm.id %}"
                       style="flex: 1;
                              padding: 1.125rem 2rem;
                              background: rgba(255, 255, 255, 0.05);
                              border: 2px solid rgba(255, 255, 255, 0.1);
                              border-radius: 12px;
                              color: var(--text-primary);
                              text-decoration: none;
                              font-weight: 600;
                              font-size: 1rem;
                              display: flex;
                              align-items: center;
                              justify-content: center;
                              gap: 0.5rem;
                              transition: all 0.3s ease;">
                        <i class="bi bi-x-circle"></i> Cancel
                    </a>
                    <button type="submit"
                            style="flex: 2;
                                   padding: 1.125rem 2rem;
                                   background: linear-gradient(135deg, var(--accent-cyan), var(--accent-blue));
                                   border: none;
                                   border-radius: 12px;
                                   color: white;
                                   font-weight: 700;
                                   font-size: 1.125rem;
                                   display: flex;
                                   align-items: center;
                                   justify-content: center;
                                   gap: 0.625rem;
                                   cursor: pointer;
                                   transition: all 0.3s ease;
                                   box-shadow: 0 8px 24px rgba(6, 182, 212, 0.3);">
                        <i class="bi bi-camera-fill"></i> Create Snapshot
                    </button>
                </div>
            </form>
        </div>

        <!-- Information Card -->
        <div class="task-card" style="padding: 1.5rem; margin-top: 1.5rem; background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.2);">
            <h4 style="font-size: 1rem; font-weight: 600; margin: 0 0 1rem 0; color: var(--accent-blue); display: flex; align-items: center; gap: 0.5rem;">
                <i class="bi bi-lightbulb"></i> Snapshot Information
            </h4>
            <ul style="margin: 0; padding-left: 1.5rem; color: var(--text-secondary); font-size: 0.9375rem; line-height: 1.8;">
                <li>Snapshots capture the current state of your VM</li>
                <li>You can restore to a snapshot at any time</li>
                <li>Snapshots include disk state and memory (if VM is running)</li>
                <li>Multiple snapshots can be created for the same VM</li>
                <li>Snapshot creation is non-disruptive to running VMs</li>
            </ul>
        </div>
    </div>

    <!-- VM Info Card -->
    <div>
        <div class="task-card" style="padding: 1.5rem; background: rgba(42, 47, 84, 0.6);">
            <h4 style="font-size: 1.125rem; font-weight: 600; margin: 0 0 1.5rem 0; color: var(--text-primary); display: flex; align-items: center; gap: 0.625rem;">
                <i class="bi bi-info-circle" style="color: var(--accent-purple);"></i>
                VM Information
            </h4>

            <!-- VM Name -->
            <div style="margin-bottom: 1.5rem;">
                <div style="font-size: 0.8125rem; color: var(--text-secondary); margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600;">Virtual Machine</div>
                <div style="font-size: 1.125rem; font-weight: 600; color: var(--text-primary); display: flex; align-items: center; gap: 0.5rem;">
                    <i class="bi bi-{% if vm.vm_type == 'qemu' %}laptop{% else %}box{% endif %}" style="color: var(--accent-cyan);"></i>
                    {{ vm.name }}
                </div>
            </div>

            <!-- VM ID -->
            <div style="margin-bottom: 1.5rem;">
                <div style="font-size: 0.8125rem; color: var(--text-secondary); margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600;">VM ID</div>
                <div style="font-size: 1.125rem; font-weight: 600; color: var(--text-primary);">{{ vm.vmid }}</div>
            </div>

            <!-- Current Status -->
            <div style="margin-bottom: 1.5rem;">
                <div style="font-size: 0.8125rem; color: var(--text-secondary); margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600;">Current Status</div>
                <div>
                    {% if vm.status == 'running' %}
                        <span class="badge badge-success" style="padding: 0.5rem 1rem; font-size: 0.875rem;">
                            <i class="bi bi-circle-fill" style="font-size: 0.5rem;"></i> Running
                        </span>
                    {% elif vm.status == 'stopped' %}
                        <span class="badge badge-warning" style="padding: 0.5rem 1rem; font-size: 0.875rem;">
                            <i class="bi bi-circle-fill" style="font-size: 0.5rem;"></i> Stopped
                        </span>
                    {% else %}
                        <span class="badge" style="background: var(--text-secondary); padding: 0.5rem 1rem; font-size: 0.875rem;">
                            {{ vm.status|title }}
                        </span>
                    {% endif %}
                </div>
            </div>

            <!-- Node -->
            <div style="margin-bottom: 1.5rem;">
                <div style="font-size: 0.8125rem; color: var(--text-secondary); margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600;">Node</div>
                <div style="font-size: 1rem; font-weight: 500; color: var(--accent-cyan);">
                    <i class="bi bi-hdd-rack"></i> {{ vm.node.name }}
                </div>
            </div>

            <!-- Divider -->
            <div style="height: 1px; background: rgba(255, 255, 255, 0.1); margin: 1.5rem 0;"></div>

            <!-- Resource Stats -->
            <h5 style="font-size: 0.875rem; font-weight: 600; margin: 0 0 1rem 0; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px;">Resources</h5>

            <div style="display: flex; flex-direction: column; gap: 1rem;">
                <!-- CPU -->
                <div style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; background: rgba(147, 51, 234, 0.1); border-radius: 8px; border: 1px solid rgba(147, 51, 234, 0.2);">
                    <div style="width: 36px; height: 36px; background: rgba(147, 51, 234, 0.2); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                        <i class="bi bi-cpu" style="color: var(--accent-purple); font-size: 1.125rem;"></i>
                    </div>
                    <div>
                        <div style="font-size: 0.75rem; color: var(--text-secondary);">CPU Cores</div>
                        <div style="font-size: 1rem; font-weight: 700; color: var(--accent-purple);">{{ vm.cpu_cores }}</div>
                    </div>
                </div>

                <!-- RAM -->
                <div style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; background: rgba(6, 182, 212, 0.1); border-radius: 8px; border: 1px solid rgba(6, 182, 212, 0.2);">
                    <div style="width: 36px; height: 36px; background: rgba(6, 182, 212, 0.2); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                        <i class="bi bi-memory" style="color: var(--accent-cyan); font-size: 1.125rem;"></i>
                    </div>
                    <div>
                        <div style="font-size: 0.75rem; color: var(--text-secondary);">Memory</div>
                        <div style="font-size: 1rem; font-weight: 700; color: var(--accent-cyan);">{{ vm.ram_mb }} MB</div>
                    </div>
                </div>

                <!-- Disk -->
                <div style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; background: rgba(16, 185, 129, 0.1); border-radius: 8px; border: 1px solid rgba(16, 185, 129, 0.2);">
                    <div style="width: 36px; height: 36px; background: rgba(16, 185, 129, 0.2); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                        <i class="bi bi-device-hdd" style="color: var(--accent-green); font-size: 1.125rem;"></i>
                    </div>
                    <div>
                        <div style="font-size: 0.75rem; color: var(--text-secondary);">Disk Space</div>
                        <div style="font-size: 1rem; font-weight: 700; color: var(--accent-green);">{{ vm.disk_gb|floatformat:1 }} GB</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    /* Input Focus States */
    input[type="text"]:focus,
    textarea:focus {
        border-color: var(--accent-cyan) !important;
        box-shadow: 0 0 0 3px rgba(6, 182, 212, 0.1) !important;
    }

    /* Button Hover Effects */
    button[type="submit"]:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 32px rgba(6, 182, 212, 0.4) !important;
    }

    a[href*="vm_detail"]:hover {
        background: rgba(255, 255, 255, 0.1) !important;
        border-color: rgba(255, 255, 255, 0.2) !important;
    }

    /* Smooth Transitions */
    input, textarea, button, a {
        transition: all 0.3s ease;
    }
</style>
{% endblock %}
